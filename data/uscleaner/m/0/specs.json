{
    "$schema": "../../../../__tests__/schema.json",
    "iohandlers": [
        {
            "name": "EM4",
            "type": "em4",
            "ip": "192.168.1.3"
        }
    ],
    "iogates": [
        {
            "name": "emergency_stop",
            "type": "default",
            "bus": "in",
            "size": "bit",
            "automaton": 0,
            "address": 1016,
            "default": 0,
            "isCritical": true
        },
        {
            "name": "cover_closed",
            "type": "default",
            "bus": "in",
            "size": "bit",
            "automaton": 0,
            "address": 1017,
            "default": 0
        },
        {
            "name": "temperature",
            "type": "em4temp",
            "bus": "in",
            "size": "word",
            "automaton": 0,
            "address": 26,
            "default": 20
        },
        {
            "name": "motor-speed",
            "type": "em4a10v",
            "bus": "out",
            "size": "word",
            "automaton": 0,
            "address": 1,
            "default": 0
        },
        {
            "name": "motor-direction",
            "type": "default",
            "bus": "out",
            "size": "bit",
            "automaton": 0,
            "address": 1000,
            "default": 0
        },
        {
            "name": "us_power",
            "type": "default",
            "bus": "out",
            "size": "bit",
            "automaton": 0,
            "address": 1003,
            "default": 0
        },
        {
            "name": "temperature-heater",
            "type": "default",
            "bus": "out",
            "size": "bit",
            "automaton": 0,
            "address": 1001,
            "default": 0
        },
        {
            "name": "temperature-ventilation",
            "type": "default",
            "bus": "out",
            "size": "bit",
            "automaton": 0,
            "address": 1004,
            "default": 0
        },
        {
            "name": "pump",
            "type": "default",
            "bus": "out",
            "size": "bit",
            "automaton": 0,
            "address": 1002,
            "default": 0
        }
    ],
    "slots": [
        {
            "name": "bac",
            "type": "media",
            "isProductable": false,
            "sensors": [
                {
                    "io": "temperature",
                    "type": "temperature"
                }
            ]
        }
    ],
    "profiles": {
        "skeletons": [
            {
                "identifier": "default",
                "fieldGroups": [
                    {
                        "name": "principal",
                        "fields": [
                            {
                                "name": "duration",
                                "unity": "m-s",
                                "type": "int",
                                "value": 300
                            },
                            {
                                "name": "target-temperature",
                                "unity": "°C",
                                "type": "int",
                                "value": 20
                            },
                            {
                                "name": "motor-speed",
                                "unity": "%",
                                "type": "float",
                                "value": 50,
                                "floatMin": 0,
                                "floatMax": 100,
                                "floatStep": 5
                            }
                        ]
                    }
                ]
            }
        ],
        "premades": [
            {
                "skeleton": "default",
                "id": "premade_5min30deg",
                "name": "5min30deg",
                "removable": false,
                "overwriteable": false,
                "isPremade": true,
                "values": {
                    "principal#duration": 600,
                    "principal#target-temperature": 30,
                    "principal#motor-speed": 50
                }
            }
        ]
    },
    "maintenance": [
        {
            "name": "filter",
            "durationType": "time",
            "durationLimit": 15,
            "procedure": {
                "tools": [],
                "steps": [
                    {
                        "name": "Ouverture de la porte de maintenance",
                        "images": [
                            "1.jpg"
                        ]
                    },
                    {
                        "name": "Fermeture des vannes reliées a la pompe",
                        "images": [
                            "2.jpg",
                            "3.jpg"
                        ]
                    },
                    {
                        "name": "Dévissage du couvercle de la pompe",
                        "images": [
                            "4.jpg"
                        ]
                    },
                    {
                        "name": "Retirer le filtre de la pompe",
                        "images": [
                            "5.jpg",
                            "6.jpg"
                        ]
                    },
                    {
                        "name": "Remplacement du filtre de la pompe",
                        "images": [
                            "7.jpg",
                            "8.jpg"
                        ]
                    },
                    {
                        "name": "Re-ouverture des vannes",
                        "images": [
                            "9.jpg"
                        ]
                    },
                    {
                        "name": "Fermeture de la pompe",
                        "images": [
                            "5.jpg",
                            "4.jpg"
                        ]
                    },
                    {
                        "name": "Fermeture de la porte",
                        "images": [
                            "1.jpg"
                        ]
                    }
                ]
            }
        }
    ],
    "passives": [],
    "manual": [
        {
            "name": "motor-rotation",
            "incompatibility": [],
            "controls": [
                {
                    "name": "motor-speed",
                    "analogScaleDependant": true
                }
            ],
            "analogScale": {
                "min": 0,
                "max": 100
            },
            "watchdog": [
                {
                    "gateName": "cover_closed",
                    "gateValue": 1
                }
            ]
        },
        {
            "name": "pump",
            "incompatibility": [],
            "controls": [
                {
                    "name": "pump"
                }
            ]
        },
        {
            "name": "us_cleaning",
            "incompatibility": [],
            "controls": [
                {
                    "name": "us_power"
                }
            ]
        },
        {
            "name": "bac_heating",
            "incompatibility": [
                "bac_cooling",
                "+pump"
            ],
            "controls": [
                {
                    "name": "temperature-heater"
                }
            ],
            "watchdog": [
                {
                    "gateName": "temperature",
                    "gateValue": 60
                }
            ]
        },
        {
            "name": "bac_cooling",
            "incompatibility": [
                "bac_heating",
                "+pump"
            ],
            "controls": [
                {
                    "name": "temperature-ventilation"
                }
            ]
        }
    ],
    "cycles": {
        "premades": [
            {
                "name": "5min30deg",
                "profile": "premade_5min30deg",
                "cycle": "default"
            }
        ],
        "types": [
            {
                "name": "default",
                "profileRequired": true,
                "watchdogConditions": [
                    {
                        "gateName": "emergency_stop",
                        "gateValue": 1,
                        "startOnly": false,
                        "result": false
                    }
                ],
                "steps": [
                    {
                        "name": "cleaning",
                        "isEnabled": {
                            "name": "const",
                            "value": "1"
                        },
                        "duration": {
                            "name": "profile",
                            "value": "principal.duration"
                        },
                        "startBlocks": [
                            {
                                "name": "io",
                                "params": [
                                    {
                                        "name": "conststr",
                                        "value": "pump"
                                    },
                                    {
                                        "name": "const",
                                        "value": "1"
                                    }
                                ]
                            },
                            {
                                "name": "io",
                                "params": [
                                    {
                                        "name": "conststr",
                                        "value": "motor-speed"
                                    },
                                    {
                                        "name": "profile",
                                        "value": "principal.motor-speed"
                                    }
                                ]
                            },
                            {
                                "name": "io",
                                "params": [
                                    {
                                        "name": "conststr",
                                        "value": "us_power"
                                    },
                                    {
                                        "name": "const",
                                        "value": "1"
                                    }
                                ]
                            },
                            {
                                "name": "startTimer",
                                "params": [
                                    {
                                        "name": "conststr",
                                        "value": "temperatureControl"
                                    },
                                    {
                                        "name": "const",
                                        "value": "5000"
                                    }
                                ],
                                "blocks": [
                                    {
                                        "name": "if",
                                        "params": [
                                            {
                                                "name": "io",
                                                "value": "temperature"
                                            },
                                            {
                                                "name": "conststr",
                                                "value": ">"
                                            },
                                            {
                                                "name": "profile",
                                                "value": "principal.target-temperature"
                                            }
                                        ],
                                        "blocks": [
                                            {
                                                "_comment": "Enable heating if temperature is too high",
                                                "name": "io",
                                                "params": [
                                                    {
                                                        "name": "conststr",
                                                        "value": "temperature-heater"
                                                    },
                                                    {
                                                        "name": "const",
                                                        "value": "0"
                                                    }
                                                ]
                                            },
                                            {
                                                "_comment": "Disable heating if temperature is too high",
                                                "name": "io",
                                                "params": [
                                                    {
                                                        "name": "conststr",
                                                        "value": "temperature-heater"
                                                    },
                                                    {
                                                        "name": "const",
                                                        "value": "1"
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "_comment": "If temperature is more than 2 degress higher than set value enable heat exchanger",
                                        "name": "if",
                                        "params": [
                                            {
                                                "name": "profile",
                                                "value": "principal.target-temperature"
                                            },
                                            {
                                                "name": "conststr",
                                                "value": ">"
                                            },
                                            {
                                                "name": "add",
                                                "value": "",
                                                "params": [
                                                    {
                                                        "name": "const",
                                                        "value": "1"
                                                    },
                                                    {
                                                        "name": "io",
                                                        "value": "temperature"
                                                    }
                                                ]
                                            }
                                        ],
                                        "blocks": [
                                            {
                                                "_comment": "Enable cooling if temperature is too high",
                                                "name": "io",
                                                "params": [
                                                    {
                                                        "name": "conststr",
                                                        "value": "temperature-cooler"
                                                    },
                                                    {
                                                        "name": "const",
                                                        "value": "1"
                                                    }
                                                ]
                                            },
                                            {
                                                "_comment": "Disable cooler if temperature is too low",
                                                "name": "io",
                                                "params": [
                                                    {
                                                        "name": "conststr",
                                                        "value": "temperature-cooler"
                                                    },
                                                    {
                                                        "name": "const",
                                                        "value": "0"
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "endBlocks": [
                            {
                                "name": "stopTimer",
                                "params": [
                                    {
                                        "name": "conststr",
                                        "value": "temperatureControl"
                                    }
                                ],
                                "_folded": false
                            },
                            {
                                "name": "io",
                                "params": [
                                    {
                                        "name": "conststr",
                                        "value": "pump"
                                    },
                                    {
                                        "name": "const",
                                        "value": "1"
                                    }
                                ]
                            },
                            {
                                "name": "io",
                                "params": [
                                    {
                                        "name": "conststr",
                                        "value": "us_power"
                                    },
                                    {
                                        "name": "const",
                                        "value": "0"
                                    }
                                ]
                            },
                            {
                                "name": "io",
                                "params": [
                                    {
                                        "name": "conststr",
                                        "value": "motor-speed"
                                    },
                                    {
                                        "name": "profile",
                                        "value": "principal.motor-speed"
                                    }
                                ]
                            }
                        ],
                        "blocks": [
                            {
                                "name": "sleep",
                                "params": [
                                    {
                                        "name": "profile",
                                        "value": "principal.duration"
                                    }
                                ]
                            }
                        ]
                    }
                ]
            }
        ]
    }
}