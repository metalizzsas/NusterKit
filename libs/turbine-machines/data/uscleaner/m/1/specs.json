{
    "$schema": "../../../../node_modules/@metalizzsas/nuster-typings/build/schemas/schema-specs.json",
    "iohandlers": [
        {
            "type": "wago",
            "ip": "192.168.1.10"
        }
    ],
    "iogates": [
        {
            "name": "emergency-stop",
            "type": "default",
            "bus": "in",
            "size": "bit",
            "controllerId": 0,
            "address": 0,
            "default": 0
        },
        {
            "name": "cover-closed",
            "type": "default",
            "bus": "in",
            "size": "bit",
            "controllerId": 0,
            "address": 1,
            "default": 0
        },
        {
            "name": "pump#pressure",
            "type": "mapped",
            "bus": "in",
            "size": "word",
            "controllerId": 0,
            "address": 0,
            "default": 0,
            "unity": "bar",
            "mapInMin": 0,
            "mapInMax": 32767,
            "mapOutMin": 0,
            "mapOutMax": 1.6
        },
        {
            "name": "temperature#sensor",
            "type": "pt100",
            "bus": "in",
            "size": "word",
            "controllerId": 0,
            "address": 4,
            "default": 20,
            "unity": "°C"
        },
        {
            "name": "motor#speed",
            "type": "mapped",
            "bus": "out",
            "size": "word",
            "controllerId": 0,
            "address": 0,
            "default": 0,
            "unity": "RPM",
            "mapInMin": 0,
            "mapInMax": 16384,
            "mapOutMin": 0,
            "mapOutMax": 55
        },
        {
            "name": "motor#direction",
            "type": "default",
            "bus": "out",
            "size": "bit",
            "controllerId": 0,
            "address": 0,
            "default": 0
        },
        {
            "name": "us-power",
            "type": "default",
            "bus": "out",
            "size": "bit",
            "controllerId": 0,
            "address": 1,
            "default": 0
        },
        {
            "name": "pump#enable",
            "type": "default",
            "bus": "out",
            "size": "bit",
            "controllerId": 0,
            "address": 4,
            "default": 0
        }
    ],
    "slots": [
        {
            "name": "bac",
            "type": "media",
            "supportedProductSeries": ["cr", "any"],
            "sensors": [
                {
                    "io": "temperature#sensor",
                    "type": "temperature"
                }
            ]
        }
    ],
    "profileSkeletons": [
        {
            "name": "default",
            "fields": [
                {
                    "name": "principal#duration",
                    "type": "time",
                    "units": [
                        "minutes",
                        "seconds"
                    ],
                    "value": 300
                },
                {
                    "name": "principal#motor-speed",
                    "unity": "RPM",
                    "type": "float",
                    "value": 25,
                    "floatMin": 0,
                    "floatMax": 55,
                    "floatStep": 5
                }
            ]
        }
    ],
    "profilePremades": [
        {
            "skeleton": "default",
            "_id": "premade_5min",
            "name": "5min",
            "isPremade": true,
            "isRemovable": false,
            "isOverwritable": false,
            "values": {
                "principal#duration": 300,
                "principal#motor-speed": 25
            }
        }
    ],
    "maintenance": [
        {
            "name": "usc-filter",
            "durationType": "sensor",
            "sensorBaseValue": 0.14,
            "sensorLimitValue": 0.10,
            "sensorGate": "pump#pressure",
            "requireEnableGate": "pump#enable",
            "procedure": {
                "tools": [],
                "steps": [
                    {
                        "name": "open-door",
                        "media": [
                            "1.jpg"
                        ]
                    },
                    {
                        "name": "close-valve-pump",
                        "media": [
                            "2.jpg",
                            "3.jpg"
                        ]
                    },
                    {
                        "name": "pump-cover-unscrew",
                        "media": [
                            "4.jpg"
                        ]
                    },
                    {
                        "name": "filter-out-pump",
                        "media": [
                            "5.jpg",
                            "6.jpg"
                        ]
                    },
                    {
                        "name": "replace-pump-filter",
                        "media": [
                            "7.jpg",
                            "8.jpg"
                        ]
                    },
                    {
                        "name": "pump-cover-screw",
                        "media": [
                            "5.jpg",
                            "4.jpg"
                        ]
                    },
                    {
                        "name": "open-valve-pump",
                        "media": [
                            "9.jpg"
                        ]
                    },
                    {
                        "name": "door-close",
                        "media": [
                            "1.jpg"
                        ]
                    }
                ]
            }
        }
    ],
    "manual": [
        {
            "name": "motor-rotation",
            "controls": [
                {
                    "name": "motor#speed",
                    "analogScaleDependant": true,
                    "isValueAbsolute": true 
                },
                {
                    "name": "motor#direction",
                    "analogScaleDependant": false,
                    "triggerWhenNegative": true
                }
            ],
            "analogScale": {
                "min": -55,
                "max": 55
            },
            "watchdog": [
                {
                    "gateName": "cover-closed",
                    "gateValue": 1
                }
            ]
        },
        {
            "name": "pump",
            "controls": [
                "pump#enable"
            ]
        },
        {
            "name": "us-cleaning",
            "controls": [
                "us-power"
            ]
        }
    ],
    "cyclePremades": [],
    "cycleTypes": [
        {
            "name": "default",
            "profileRequired": true,
            "startConditions": [
                {
                    "conditionName": "emergency-stop",
                    "startOnly": false,
                    "checkchain": {
                        "io": {
                            "gateName": "emergency-stop",
                            "gateValue": 1
                        }
                    }
                },
                {
                    "conditionName": "cover-closed",
                    "startOnly": false,
                    "checkchain": {
                        "io": {
                            "gateName": "cover-closed",
                            "gateValue": 1
                        }
                    }
                }
            ],
            "additionalInfo": [
                {
                    "name": "gate",
                    "value": "temperature#sensor"
                }
            ],
            "steps": [
                {
                    "name": "cleaning",
                    "isEnabled": 1,
                    "duration": {"profile": "principal#duration"},
                    "startBlocks": [
                        {"io_write": ["pump#enable", 1]},
                        {"io_write": ["motor#speed", {"profile": "principal#motor-speed"}]},
                        {"io_write": ["us-power", 1]}
                    ],
                    "endBlocks": [
                        {"io_write": ["pump#enable", 0]},
                        {"io_write": ["motor#speed", 0]},
                        {"io_write": ["us-power", 0]}
                    ],
                    "blocks": [
                        {"sleep": {"divide": [{"profile": "principal#duration"}, 2]}},
                        {"io_write": ["motor#direction", 1]},
                        {"sleep": {"divide": [{"profile": "principal#duration"}, 2]}}
                    ]
                }
            ]
        }
    ],
    "addons": [
        {
            "addonName": "temperature-control",
            "content": [
                {
                    "path": "iogates",
                    "mode": "merge",
                    "content": [
                        {
                            "name": "temperature#heater",
                            "type": "default",
                            "bus": "out",
                            "size": "bit",
                            "controllerId": 0,
                            "address": 2,
                            "default": 0
                        },
                        {
                            "name": "temperature#ventilation",
                            "type": "default",
                            "bus": "out",
                            "size": "bit",
                            "controllerId": 0,
                            "address": 3,
                            "default": 0
                        }
                    ]
                },
                {
                    "path": "profileSkeletons.0.fields",
                    "mode": "merge",
                    "content": [{
                        "name": "principal#target-temperature",
                        "unity": "°C",
                        "type": "int",
                        "value": 20
                    }]
                },
                {
                    "path": "profilePremades.0",
                    "mode": "replace",
                    "content": [
                        {
                            "skeleton": "default",
                            "_id": "premade_10min30deg",
                            "name": "10min30deg",
                            "isRemovable": false,
                            "isOverwritable": false,
                            "isPremade": true,
                            "values": {
                                "principal#duration": 600,
                                "principal#target-temperature": 30,
                                "principal#motor-speed": 25
                            }
                        }
                    ]
                },
                {
                    "mode": "merge",
                    "path": "slots.0.sensors.0.regulation",
                    "content": {
                        "manualModes": ["pump"],
                        "actuators": {
                            "plus": "temperature#heater",
                            "minus": "temperature#ventilation"
                        }
                    }
                },
                {
                    "mode": "merge",
                    "path": "manual",
                    "content": [
                        {
                            "name": "bac#heating",
                            "incompatibility": [
                                "bac#cooling"
                            ],
                            "requires": [
                                "pump"
                            ],
                            "controls": [
                                "temperature#heater"
                            ],
                            "watchdog": [
                                {
                                    "gateName": "temperature#sensor",
                                    "gateValue": 60
                                }
                            ]
                        },
                        {
                            "name": "bac#cooling",
                            "incompatibility": [
                                "bac#heating"
                            ],
                            "requires": [
                                "pump"
                            ],
                            "controls": [
                                "temperature#ventilation"
                            ]
                        }
                    ]
                },
                {
                    "path": "maintenance.0.sensorBaseValue",
                    "mode": "set",
                    "content": 0.20
                },
                {
                    "path": "maintenance.0.sensorLimitValue",
                    "mode": "set",
                    "content": 0.12
                }
            ]
        }
    ]
}