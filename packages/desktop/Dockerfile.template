FROM balenalib/raspberrypi4-64-node:18-buster

WORKDIR /usr/src/app

COPY package*.json /usr/src/app/
COPY .npmrc ./

COPY ./CHANGELOG.md ./CHANGELOG.md

COPY build/ /build/

# Install Prod npm packages
RUN pnpm install

# Remove npmrc file
RUN rm .npmrc

# Run args
CMD [ "node", "build" ]
EXPOSE 4079
ENV PORT=4079
ENV NODE_ENV=production