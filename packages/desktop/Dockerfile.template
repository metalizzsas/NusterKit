FROM balenalib/raspberrypi4-64-node:18-buster

RUN corepack enable

ENV NODE_ENV=production

WORKDIR /usr/src/app

# Copy .npmrc to authenticate to github npm registry
COPY .npmrc ./.npmrc

# Copy deployed
COPY deploy/desktop/ .

# pnpm fetch ne n√©cessite que lockfile
COPY pnpm-lock.yaml ./

RUN pnpm fetch --prod

RUN pnpm install -r --prefer-offline --prod

# Remove npmrc file
RUN rm .npmrc

# Run args
CMD [ "node", "build" ]
EXPOSE 4081
ENV PORT=4081